buildscript {
	ext.intellijBaseVersion = "2018.1"
}

plugins {
  id "org.jetbrains.intellij" version "0.3.2"
	//id "org.jetbrains.intellij" version "0.2.17"

}

//apply plugin: 'org.jetbrains.intellij'
apply plugin: "kotlin"
apply plugin: "idea"

//configurations {
//	ideaPlugins
//}

sourceSets {
	main.kotlin.srcDirs += "src"
	main.resources.srcDirs += "resources"
	test.kotlin.srcDirs += "test"
	//gradleToolingExtension {
	//	configurations[compileOnlyConfigurationName].extendsFrom(configurations["gradleToolingExtension"])
	//}
}


dependencies {
	compile project(":ktor-generator-jvm")
	compile "org.jetbrains.kotlinx:kotlinx-coroutines-core:0.22.5"
}


def intellijVersion = "IC-$intellijBaseVersion"

def intellijPlugin(String name) {
	return [
		"group": "org.jetbrains.plugins",
		"name": name,
		"version": intellijBaseVersion,
		"configuration": "compile"
	]
}

intellij {
	version intellijVersion
	plugins = ['maven', 'gradle', 'properties', 'junit', 'coverage']
	pluginName 'ktor'
	downloadSources true
}

//publishPlugin {
//	if (globalProps.jetbrainsUsername != null) {
//		username globalProps.jetbrainsUsername
//		password globalProps.jetbrainsPassword
//	}
//}

runIde {
	maxHeapSize = "2g"
}

repositories {
	jcenter()
	maven { url "https://plugins.gradle.org/m2/" }
}

println(intellijPlugin("gradle"))
